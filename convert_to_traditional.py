#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
將所有 Markdown 文件從簡體中文轉換為繁體中文
"""

import os
import sys
import io
from pathlib import Path
from typing import Dict

# 確保 stdout 能夠正確輸出中文
sys.stdout = io.TextIOWrapper(sys.stdout.buffer, encoding='utf-8')

# 簡繁轉換對應表（常見詞彙）
CONVERT_DICT = {
    # 常用詞彙轉換對
    '数据': '資料',
    '源': '源',
    '注册': '註冊',
    '模块': '模組',
    '详细': '詳細',
    '功能': '功能',
    '清单': '清單',
    '索引': '索引',
    '技术': '技術',
    '架构': '架構',
    '核心': '核心',
    '组件': '組件',
    '实现': '實現',
    '规范': '規範',
    '性能': '效能',
    '优化': '優化',
    '策略': '策略',
    '安全': '安全',
    '考虑': '考慮',
    '与': '與',
    '其他': '其他',
    '交互': '交互',
    '部署': '部署',
    '灾难': '災難',
    '恢复': '恢復',
    '计划': '計畫',
    '监控': '監控',
    '告警': '告警',
    '流程': '流程',
    '持续': '持續',
    '集成': '整合',
    '合规': '合規',
    '管理': '管理',
    '存储': '儲存',
    '检索': '檢索',
    '元数据': '元資料',
    '周期': '週期',
    '平台': '平台',
    '资源': '資源',
    '协调': '協調',
    '支持': '支援',
    '网页': '網頁',
    '数据库': '資料庫',
    '对象': '物件',
    '异构': '異構',
    '类型': '類型',
    '适应': '適應',
    '企业': '企業',
    '大规模': '大規模',
    '并发': '並發',
    '接入': '接入',
    '职责': '職責',
    '采集': '採集',
    '信息': '資訊',
    '结构': '結構',
    '描述': '描述',
    '连接': '連接',
    '更新': '更新',
    '时间': '時間',
    '拥有者': '擁有者',
    '状态': '狀態',
    '层次': '層次',
    '标签': '標籤',
    '分组': '分組',
    '分类': '分類',
    '组织': '組織',
    '发现': '發現',
    '查询': '查詢',
    '能力': '能力',
    '条件': '條件',
    '全文': '全文',
    '快速': '快速',
    '引擎': '引擎',
    '秒级': '秒級',
    '响应': '響應',
    '下游': '下游',
    '业务': '業務',
    '根据': '根據',
    '权限': '權限',
    '精准': '精準',
    '推荐': '推薦',
    '推送': '推送',
    '版本': '版本',
    '控制': '控制',
    '变更': '變更',
    '追踪': '追蹤',
    '历史': '歷史',
    '对比': '對比',
    '完整': '完整',
    '审计': '審計',
    '链路': '鏈路',
    '保障': '保障',
    '操作': '操作',
    '过程': '過程',
    '租户': '租戶',
    '粒度': '粒度',
    '访问': '訪問',
    '确保': '確保',
    '可控': '可控',
    '认证': '認證',
    '授权': '授權',
    '防止': '防止',
    '未授权': '未授權',
    '健康': '健康',
    '质量': '品質',
    '评估': '評估',
    '联动': '聯動',
    '定期': '定期',
    '获取': '獲取',
    '最新': '最新',
    '可用性': '可用性',
    '评分': '評分',
    '及时': '及時',
    '用户': '用戶',
    '任务': '任務',
    '分配': '分配',
    '预警': '預警',
    '参考': '參考',
    '辅助': '輔助',
    '自动': '自動',
    '决策': '決策',
    '作为': '作為',
    '统一': '統一',
    '支撑': '支撐',
    '直接': '直接',
    '服务': '服務',
    '处理': '處理',
    '工作': '工作',
    '分析': '分析',
    '媒体': '媒體',
    '多个': '多個',
    '功能型': '功能型',
    '跨': '跨',
    '项目': '專案',
    '团队': '團隊',
    '共建': '共建',
    '共用': '共用',
    '定位': '定位',
    '关系': '關係',
    '中枢': '中樞',
    '搜索': '搜尋',
    '来源': '來源',
    '依赖': '依賴',
    '系统': '系統',
    '价值': '價值',
    '指标': '指標',
    '当前': '當前',
    '目标': '目標',
    '说明': '說明',
    '上限': '上限',
    '保证': '保證',
    '一致性': '一致性',
    '要求': '要求',
    '覆盖': '覆蓋',
    '纳入': '納入',
    '占比': '佔比',
    '审计': '審計',
    '被': '被',
    '典型': '典型',
    '场景': '場景',
    '示例': '示例',
    '或': '或',
    '程序': '程序',
    '通过': '通過',
    '门户': '門戶',
    '提交': '提交',
    '参数': '參數',
    '调用': '調用',
    '解析': '解析',
    '入库': '入庫',
    '供': '供',
    '引用': '引用',
    '共享': '共享',
    '可被': '可被',
    '授权': '授權',
    '给': '給',
    '使用': '使用',
    '列表': '列表',
    '记录': '記錄',
    '情况': '情況',
    '追溯': '追溯',
    '被依赖': '被依賴',
    '当': '當',
    '访': '訪',
    '发生': '發生',
    '每次': '每次',
    '详情': '詳情',
    '随': '隨',
    '切换': '切換',
    '对': '對',
    '异常': '異常',
    '检测': '檢測',
    '连续': '連續',
    '波动': '波動',
    '主': '主',
    '动': '動',
    '告': '告',
    '所有': '所有',
    '者': '者',
    '并': '並',
    '在': '在',
    '标': '標',
    '注': '註',
    '高': '高',
    '风': '風',
    '险': '險',
    '源': '源',
    '关': '關',
    '键': '鍵',
    '设计': '設計',
    '原则': '原則',
    '扩展': '擴展',
    '遵': '遵',
    '循': '循',
    '单一': '單一',
    '真': '真',
    '相': '相',
    '保': '保',
    '证': '證',
    '须': '須',
    '重': '重',
    '复': '複',
    '度': '度',
    '便': '便',
    '于': '於',
    '后': '後',
    '续': '續',
    '新': '新',
    '等': '等',
    '丰': '豐',
    '富': '富',
    '开': '開',
    '接': '接',
    '相关': '相關',
    '章': '章',
    '节': '節',
    '前': '前',
    '序': '序',
    '速': '速',
    '链': '鏈',
    '返回': '返回',
    '首': '首',
    '页': '頁',
    '网站': '網站',
    '指纹': '指紋',
    '负责': '負責',
    '栈': '棧',
    '反爬': '反爬',
    '机制': '機制',
    '内容': '內容',
    '特征': '特徵',
    '爬虫': '爬蟲',
    '配置': '配置',
    '提供': '提供',
    '智能': '智能',
    '建议': '建議',
    '主动': '主動',
    '探测': '探測',
    '被动': '被動',
    '相结': '相結',
    '结合': '結合',
    '构建': '構建',
    '全面': '全面',
    '库': '庫',
    '存储系统': '儲存系統',
    '提取': '提取',
    '关键': '關鍵',
    '信息': '資訊',
    '定': '定',
    '义': '義',
    '基': '基',
    '础': '礎',
    '设施': '設施',
    '配': '配',
    '例': '例',
    '效': '效',
    '存': '存',
    '数': '數',
    '整': '整',
    '体': '體',
    '各': '各',
    '式': '式',
    '法': '法',
    '完': '完',
    '备': '備',
    '种': '種',
    '消': '消',
    '息': '息',
    '队': '隊',
    '列': '列',
    '持': '持',
    '有': '有',
    '号': '號',
    '段': '段',
    '特': '特',
    '性': '性',
    '承': '承',
    '诺': '諾',
    '可': '可',
    '靠': '靠',
    '序': '序',
    '列': '列',
    '理': '理',
    '念': '念',
    '体': '體',
    '现': '現',
    '延': '延',
    '迟': '遲',
    '传': '傳',
    '输': '輸',
    '预': '預',
    '期': '期',
    '事': '事',
    '件': '件',
    '驱': '驅',
    '动': '動',
    '消': '消',
    '耗': '耗',
    '吞': '吞',
    '序': '序',
    '列': '列',
}

# 增加更多常見的單字轉換
SINGLE_CHAR_CONVERT = {
    '为': '為',
    '了': '了',
    '和': '和',
    '的': '的',
    '是': '是',
    '在': '在',
    '有': '有',
    '等': '等',
    '从': '從',
    '到': '到',
    '被': '被',
    '会': '會',
    '而': '而',
    '过': '過',
    '来': '來',
    '说': '說',
    '只': '只',
    '个': '個',
    '就': '就',
    '这': '這',
    '与': '與',
    '去': '去',
    '给': '給',
    '能': '能',
    '如': '如',
    '将': '將',
    '没': '沒',
    '人': '人',
    '我': '我',
    '也': '也',
    '可': '可',
    '由': '由',
    '作': '作',
    '时': '時',
    '何': '何',
    '某': '某',
    '以': '以',
    '要': '要',
    '最': '最',
    '把': '把',
    '每': '每',
    '后': '後',
    '那': '那',
    '一': '一',
    '些': '些',
    '多': '多',
    '不': '不',
    '然': '然',
    '十': '十',
    '位': '位',
    '前': '前',
    '出': '出',
    '基': '基',
    '础': '礎',
    '中': '中',
    '被': '被',
    '作为': '作為',
    '以及': '以及',
    '被': '被',
    '当': '當',
    '这': '這',
    '如': '如',
    '将': '將',
    '没': '沒',
    '个': '個',
    '已': '已',
    '且': '且',
    '因': '因',
    '其': '其',
    '但': '但',
    '又': '又',
    '只': '只',
    '再': '再',
    '至': '至',
    '下': '下',
    '子': '子',
    '着': '著',
    '来': '來',
    '起': '起',
    '高': '高',
    '大': '大',
    '上': '上',
    '小': '小',
    '长': '長',
    '高': '高',
    '新': '新',
    '旧': '舊',
    '好': '好',
    '坏': '壞',
    '黑': '黑',
    '白': '白',
    '红': '紅',
    '绿': '綠',
    '蓝': '藍',
    '黄': '黃',
    '实': '實',
    '虚': '虛',
    '真': '真',
    '假': '假',
    '活': '活',
    '死': '死',
    '生': '生',
    '死': '死',
    '东': '東',
    '西': '西',
    '南': '南',
    '北': '北',
    '中': '中',
}

# 合併兩個字典
CONVERT_DICT.update(SINGLE_CHAR_CONVERT)

def simple_to_traditional(text: str) -> str:
    """簡繁轉換函數"""
    result = text
    # 按長度排序（降序），優先轉換長詞彙以避免部分轉換
    sorted_dict = sorted(CONVERT_DICT.items(), key=lambda x: -len(x[0]))
    for simple, traditional in sorted_dict:
        result = result.replace(simple, traditional)
    return result

def convert_md_files(root_dir: str, exclude_patterns: list = None) -> None:
    """轉換根目錄下所有 MD 文件"""
    if exclude_patterns is None:
        exclude_patterns = ['_backup_legacy']
    
    root_path = Path(root_dir)
    converted_count = 0
    failed_files = []
    
    print(f"開始掃描目錄: {root_dir}")
    
    for md_file in root_path.rglob('*.md'):
        # 跳過排除的目錄
        skip_file = False
        for pattern in exclude_patterns:
            if pattern in str(md_file):
                skip_file = True
                break
        
        if skip_file:
            continue
        
        try:
            print(f"處理: {md_file.relative_to(root_path)}")
            
            # 讀取文件
            with open(md_file, 'r', encoding='utf-8') as f:
                content = f.read()
            
            # 進行轉換
            converted_content = simple_to_traditional(content)
            
            # 寫回文件
            with open(md_file, 'w', encoding='utf-8') as f:
                f.write(converted_content)
            
            converted_count += 1
            print(f"[OK] 已轉換: {md_file.name}")
            
        except Exception as e:
            failed_files.append((str(md_file), str(e)))
            print(f"[FAIL] 失敗: {md_file.name} - {e}")
    
    # 打印總結
    print(f"\n{'='*60}")
    print(f"轉換完成!")
    print(f"成功轉換: {converted_count} 個文件")
    print(f"失敗: {len(failed_files)} 個文件")
    
    if failed_files:
        print(f"\n失敗的文件:")
        for file_path, error in failed_files:
            print(f"  - {file_path}: {error}")

if __name__ == '__main__':
    doc_dir = r'e:\Jerry_python\腳本平台\doc'
    convert_md_files(doc_dir, exclude_patterns=['_backup_legacy'])
    print("\n所有 MD 文件已完成轉換!")
