<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <!-- Basic Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>镜厅 - 技术社区 | 镜界</title>
    <meta name="description" content="数据源开发技术讨论社区，分享经验、解决问题、协作开发">
    <meta name="keywords" content="社区,论坛,技术讨论,数据源,爬虫,协作">
    <meta name="author" content="镜界平台">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🔍</text></svg>">

    <!-- Styles -->
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Libraries -->
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>

    <!-- Component System -->
    <script src="components/template-processor.js"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-gray-900 to-black text-white">
    <custom-navbar></custom-navbar>

    <div class="min-h-screen">
        <!-- Page Header -->
        <header class="pt-32 pb-16 bg-gradient-to-r from-purple-900 via-blue-900 to-indigo-900">
            <div class="container mx-auto px-4 text-center">
                <h1 class="text-4xl md:text-5xl font-bold mb-4 flex items-center justify-center gap-4">
                    <i data-feather="message-square" class="text-purple-400"></i>
                    镜厅 - 技术社区
                </h1>
                <p class="text-xl text-gray-300 max-w-3xl mx-auto">
                    连接志同道合的开发者，分享经验、解决问题、协作创新
                </p>
                <div class="flex flex-col sm:flex-row gap-4 justify-center mt-8">
                    <a href="#categories" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-medium transition-all transform hover:scale-105">
                        开始探索
                    </a>
                    <button onclick="createNewPost()" class="px-6 py-3 bg-purple-600 hover:bg-purple-700 rounded-lg font-medium transition-all transform hover:scale-105 flex items-center gap-2">
                        <i data-feather="edit"></i>发布新帖
                    </button>
                </div>
            </div>
        </header>

        <!-- Community Stats -->
        <section class="py-12 bg-gray-900/50">
            <div class="container mx-auto px-4">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                    <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 text-center border border-blue-500/30 hover:border-blue-500/50 transition-all duration-300">
                        <div class="text-3xl font-bold text-blue-400 mb-2" id="total-members">2847</div>
                        <div class="text-sm text-gray-400">社区成员</div>
                    </div>
                    <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 text-center border border-green-500/30 hover:border-green-500/50 transition-all duration-300">
                        <div class="text-3xl font-bold text-green-400 mb-2" id="total-posts">12543</div>
                        <div class="text-sm text-gray-400">讨论帖</div>
                    </div>
                    <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 text-center border border-purple-500/30 hover:border-purple-500/50 transition-all duration-300">
                        <div class="text-3xl font-bold text-purple-400 mb-2" id="total-replies">89123</div>
                        <div class="text-sm text-gray-400">回复总数</div>
                    </div>
                    <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 text-center border border-yellow-500/30 hover:border-yellow-500/50 transition-all duration-300">
                        <div class="text-3xl font-bold text-yellow-400 mb-2" id="online-users">156</div>
                        <div class="text-sm text-gray-400">在线用户</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Community Content -->
        <section class="py-12">
            <div class="container mx-auto px-4">
                <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">

                    <!-- Sidebar -->
                    <div class="lg:col-span-1 space-y-6">
                        <!-- Quick Categories -->
                        <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 border border-gray-700">
                            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                                <i data-feather="layout" class="text-blue-400"></i>
                                快速导航
                            </h3>
                            <div class="space-y-2" id="categories">
                                <a href="#" onclick="switchCategory('all')" class="block px-4 py-2 rounded-lg text-gray-300 hover:bg-blue-600/20 hover:text-blue-400 transition-all category-link active">
                                    全部讨论
                                </a>
                                <a href="#" onclick="switchCategory('tech-help')" class="block px-4 py-2 rounded-lg text-gray-300 hover:bg-blue-600/20 hover:text-blue-400 transition-all category-link">
                                    技术求助
                                </a>
                                <a href="#" onclick="switchCategory('code-share')" class="block px-4 py-2 rounded-lg text-gray-300 hover:bg-blue-600/20 hover:text-blue-400 transition-all category-link">
                                    代码分享
                                </a>
                                <a href="#" onclick="switchCategory('experience')" class="block px-4 py-2 rounded-lg text-gray-300 hover:bg-blue-600/20 hover:text-blue-400 transition-all category-link">
                                    经验分享
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Main Content -->
                    <div class="lg:col-span-3">

                        <!-- Search and Filter -->
                        <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 border border-gray-700 mb-6">
                            <div class="flex flex-col md:flex-row gap-4 items-center justify-between">
                                <div class="flex-1 flex gap-4">
                                    <div class="relative flex-1 max-w-md">
                                        <input type="text" placeholder="搜索讨论..." class="w-full px-4 py-3 pl-12 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-white" id="search-input">
                                        <i data-feather="search" class="absolute left-4 top-3.5 text-gray-500"></i>
                                    </div>
                                    <select class="px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" id="sort-select">
                                        <option>最新发布</option>
                                        <option>热门程度</option>
                                        <option>最多回复</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Posts List -->
                        <div class="space-y-6" id="posts-list">
                            <!-- Posts will be populated by JavaScript -->
                        </div>

                        <!-- Pagination -->
                        <div class="mt-12 flex justify-center">
                            <nav class="flex items-center gap-2">
                                <a href="#" class="px-4 py-2 bg-gray-800 rounded-lg hover:bg-gray-700 transition-colors">上一页</a>
                                <a href="#" class="px-4 py-2 bg-blue-600 rounded-lg">1</a>
                                <a href="#" class="px-4 py-2 bg-gray-800 rounded-lg hover:bg-gray-700 transition-colors">2</a>
                                <a href="#" class="px-4 py-2 bg-gray-800 rounded-lg hover:bg-gray-700 transition-colors">...</a>
                                <a href="#" class="px-4 py-2 bg-gray-800 rounded-lg hover:bg-gray-700 transition-colors">10</a>
                                <a href="#" class="px-4 py-2 bg-gray-800 rounded-lg hover:bg-gray-700 transition-colors">下一页</a>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Create New Post Modal -->
        <div id="new-post-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden">
            <div class="min-h-screen flex items-center justify-center px-4 py-8">
                <div class="bg-gray-800 rounded-xl border border-gray-700 w-full max-w-lg sm:max-w-xl md:max-w-2xl">
                    <div class="flex justify-between items-center p-6 border-b border-gray-700">
                        <h3 class="text-xl font-semibold">发布新讨论</h3>
                        <button onclick="closeNewPostModal()" class="text-gray-400 hover:text-white">
                            <i data-feather="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        <form id="new-post-form" class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">分类</label>
                                <select required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">选择分类</option>
                                    <option value="tech-help">技术求助</option>
                                    <option value="code-share">代码分享</option>
                                    <option value="experience">经验分享</option>
                                    <option value="data-sources">数据源讨论</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">标题</label>
                                <input type="text" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-white" placeholder="请输入讨论标题">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">内容</label>
                                <textarea required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-white resize-none" rows="6" placeholder="详细描述你的问题或分享你的经验..."></textarea>
                            </div>

                            <div class="flex gap-4 pt-4">
                                <button type="submit" class="flex-1 bg-purple-600 hover:bg-purple-700 px-6 py-3 rounded-lg font-medium transition-colors">
                                    发布讨论
                                </button>
                                <button type="button" onclick="closeNewPostModal()" class="flex-1 bg-gray-600 hover:bg-gray-700 px-6 py-3 rounded-lg font-medium transition-colors">
                                    取消
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <custom-footer></custom-footer>

    <script src="components/navbar.js"></script>
    <script src="components/footer.js"></script>
    <script src="script.js"></script>
    <script>
        feather.replace();

        // Simplified community data for component demo
        let posts = [
            {
                id: 1,
                title: "如何绕过Cloudflare的高级反爬虫保护？",
                content: "最近遇到一个网站使用了Cloudflare的最高防护等级，常规的代理IP和User-Agent轮换都已经无效了...",
                category: "tech-help",
                time: "2024-10-28 14:30",
                likes: 25,
                replies: 12,
                author: "爬虫新人"
            },
            {
                id: 2,
                title: "分享一个高效的分布式爬虫框架",
                content: "开发了一个基于Redis队列的分布式爬虫框架，支持动态IP池、自动重试、监控面板等功能...",
                category: "code-share",
                time: "2024-10-28 12:15",
                likes: 45,
                replies: 23,
                author: "架构师"
            },
            {
                id: 3,
                title: "十年爬虫经验总结：最有效的反检测策略",
                content: "从事爬虫开发已经有十年了，想和大家分享一些经过时间检验的实用策略...",
                category: "experience",
                time: "2024-10-28 10:45",
                likes: 89,
                replies: 34,
                author: "数据专家"
            }
        ];

        let currentCategory = 'all';

        // Initialize community
        function initCommunity() {
            renderPosts();
            updateCommunityStats();
        }

        // Render posts list using simplified format
        function renderPosts() {
            const postsContainer = document.getElementById('posts-list');
            let filteredPosts = posts;

            if (currentCategory !== 'all') {
                filteredPosts = posts.filter(post => post.category === currentCategory);
            }

            // Sort by likes descending
            filteredPosts.sort((a, b) => b.likes - a.likes);

            postsContainer.innerHTML = filteredPosts.length === 0 ?
                '<div class="text-center py-12 text-gray-400">该分类暂无讨论</div>' :
                filteredPosts.map(post => createPostElement(post)).join('');

            feather.replace();
        }

        function createPostElement(post) {
            const categoryLabels = {
                'tech-help': '技术求助',
                'code-share': '代码分享',
                'experience': '经验分享',
                'data-sources': '数据源讨论'
            };

            const categoryColors = {
                'tech-help': 'text-red-400',
                'code-share': 'text-blue-400',
                'experience': 'text-green-400',
                'data-sources': 'text-purple-400'
            };

            const timeAgo = formatTimeAgo(post.time);

            return `
                <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 border border-gray-700 hover:border-gray-600 transition-all duration-300">
                    <div class="flex items-start gap-4 mb-4">
                        <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center flex-shrink-0">
                            <span class="text-white font-medium text-sm">${post.author.charAt(0)}</span>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="font-medium text-white">${post.author}</span>
                                <span class="px-2 py-1 bg-gray-600 text-gray-300 text-xs rounded-full ${categoryColors[post.category]}">${categoryLabels[post.category]}</span>
                            </div>
                            <h3 class="text-lg font-semibold text-white mb-2">${post.title}</h3>
                            <p class="text-gray-300 mb-3 text-sm">${post.content.substring(0, 120)}${post.content.length > 120 ? '...' : ''}</p>

                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-4 text-sm text-gray-400">
                                    <span>${timeAgo}</span>
                                </div>
                                <div class="flex items-center gap-4">
                                    <button onclick="likePost(${post.id})" class="flex items-center gap-1 text-gray-400 hover:text-red-400 transition-colors">
                                        <i data-feather="heart" class="w-4 h-4"></i>
                                        <span>${post.likes}</span>
                                    </button>
                                    <button onclick="viewPost(${post.id})" class="flex items-center gap-1 text-gray-400 hover:text-blue-400 transition-colors">
                                        <i data-feather="message-circle" class="w-4 h-4"></i>
                                        <span>${post.replies}</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Utility functions
        function formatTimeAgo(timeString) {
            const time = new Date(timeString);
            const now = new Date();
            const diffInMs = now - time;
            const diffInMinutes = Math.floor(diffInMs / (1000 * 60));
            const diffInHours = Math.floor(diffInMinutes / 60);
            const diffInDays = Math.floor(diffInHours / 24);

            if (diffInMinutes < 60) {
                return `${diffInMinutes}分钟前`;
            } else if (diffInHours < 24) {
                return `${diffInHours}小时前`;
            } else {
                return `${diffInDays}天前`;
            }
        }

        function updateCommunityStats() {
            document.getElementById('total-members').textContent = '2847';
            document.getElementById('total-posts').textContent = posts.length.toString();
            document.getElementById('total-replies').textContent = posts.reduce((sum, post) => sum + post.replies, 0).toString();
            document.getElementById('online-users').textContent = '156';
        }

        // Event handlers
        function switchCategory(category) {
            currentCategory = category;
            document.querySelectorAll('.category-link').forEach(link => {
                link.classList.remove('active', 'bg-blue-600', 'text-blue-400');
            });
            document.querySelector('[onclick="switchCategory(\'' + category + '\')"]').classList.add('active', 'bg-blue-600', 'text-blue-400');
            renderPosts();
        }

        function createNewPost() {
            document.getElementById('new-post-modal').classList.remove('hidden');
        }

        function closeNewPostModal() {
            document.getElementById('new-post-modal').classList.add('hidden');
            document.getElementById('new-post-form').reset();
        }

        function viewPost(postId) {
            const post = posts.find(p => p.id === postId);
            if (post) {
                showToast('查看: ' + post.title, 'info');
            }
        }

        function likePost(postId) {
            const post = posts.find(p => p.id === postId);
            if (post) {
                post.likes++;
                renderPosts();
                showToast('已点赞', 'success');
            }
        }

        // Search functionality
        document.getElementById('search-input').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const postsContainer = document.getElementById('posts-list');

            if (searchTerm === '') {
                renderPosts();
                return;
            }

            const filteredPosts = posts.filter(post =>
                post.title.toLowerCase().includes(searchTerm) ||
                post.content.toLowerCase().includes(searchTerm)
            );

            postsContainer.innerHTML = filteredPosts.length === 0 ?
                '<div class="text-center py-12 text-gray-400">未找到相关讨论</div>' :
                filteredPosts.map(post => createPostElement(post)).join('');

            feather.replace();
        });

        // Form submission
        document.getElementById('new-post-form').addEventListener('submit', function(e) {
            e.preventDefault();

            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);

            const newPost = {
                id: Date.now(),
                title: data.标题,
                content: data.内容,
                category: data.分类,
                time: new Date().toISOString().replace('T', ' ').substring(0, 16),
                likes: 0,
                replies: 0,
                author: '社区成员'
            };

            posts.unshift(newPost);
            renderPosts();
            closeNewPostModal();
            showToast('讨论已发布！', 'success');
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', initCommunity);
    </script>
</body>
</html>
