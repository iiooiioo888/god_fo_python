[tool:pytest]
# pytest配置 - WebCrawler Commander

# 基本配置
minversion = 6.0
addopts =
    --verbose
    --strict-markers
    --strict-config
    --disable-warnings
    --tb=short
    --cov=backend
    --cov-report=html:htmlcov
    --cov-report=term-missing
    --cov-report=xml
    --cov-fail-under=80

# 測試發現
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# 標記
markers =
    # 測試類型
    unit: 單元測試
    integration: 集成測試
    e2e: 端到端測試
    smoke: 冒煙測試

    # 測試範圍
    config: 配置相關測試
    logging: 日誌相關測試
    security: 安全相關測試
    crawler: 爬蟲相關測試
    data: 數據處理相關測試
    monitor: 監控相關測試
    api: API相關測試

    # 測試特性
    slow: 慢速測試 (需較長執行時間)
    skip_ci: CI環境中跳過
    flaky: 不穩定測試 (可能偶爾失敗)

# 過濾器
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore:.*unclosed.*:ResourceWarning

# 非同步測試配置
asyncio_mode = auto

# 快取配置
cache_dir = .pytest_cache

# JUnit XML輸出 (CI/CD使用)
junit_family = xunit2
