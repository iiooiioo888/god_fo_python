<!-- LEGACY FILE NOTICE -->
> ⚠️ 此檔案為舊版備份，已被新檔取代： [ch1-5-数据模型详细定义.md](ch1-5-数据模型详细定义.md)\n> 備份時間：2025-10-31 12:28:26\n
---

# 第1章：数据源注册中心 (Data Source Registry)

## 1.5 数据模型详细定义

**[← 返回第1章首頁](ch1-index.md)**

---

## 1.5.1 数据源核心表

数据源核心表是存储数据源元数据的主要表，设计考虑了扩展性、查询性能和数据完整性。

### 核心字段分类

| 字段类别 | 字段示例 | 说明 |
|----------|----------|------|
| **标识字段** | id, project_id, name | 数据源的唯一标识和归属 |
| **元数据字段** | description, url, category, data_type | 数据源的基本信息和定义 |
| **状态字段** | status, created_at, updated_at, owner_id | 数据源的状态和生命周期信息 |
| **健康指标** | last_health_check, health_score, availability_7d | 数据源的健康状况指标 |
| **扩展字段** | tags, metadata, crawler_config | 可扩展的自定义信息 |

*表1.6: 数据源核心表字段分类*

### 索引策略

| 索引名称 | 字段组合 | 用途 | 适用场景 |
|----------|----------|------|----------|
| **idx_data_sources_project** | project_id | 按项目查询 | 项目内数据源查询 |
| **idx_data_sources_category** | category | 按分类查询 | 分类浏览场景 |
| **idx_data_sources_status** | status | 按状态过滤 | 状态筛选查询 |
| **idx_data_sources_health** | health_score DESC | 按健康评分排序 | 健康状态排序 |
| **idx_data_sources_updated** | updated_at DESC | 按更新时间排序 | 最新更新排序 |

*表1.7: 数据源核心表索引策略*

### 全文搜索优化

- 使用PostgreSQL的tsvector类型存储全文搜索向量
- 通过触发器自动更新搜索向量
- 创建GIN索引提高搜索性能

---

## 1.5.2 数据源版本表

数据源版本表记录数据源的所有变更历史，支持版本管理和回滚操作。

### 版本管理策略

| 策略 | 说明 | 优势 | 适用场景 |
|------|------|------|----------|
| **完整存储** | 存储每次变更的完整数据 | 简单直观，恢复快 | 变更不频繁的数据源 |
| **差异存储** | 仅存储与前一版本的差异 | 节省存储空间 | 频繁变更的数据源 |
| **快照存储** | 定期创建完整快照 | 平衡存储和恢复性能 | 大型数据源 |
| **混合存储** | 结合以上策略 | 灵活平衡各方面需求 | 复杂场景 |

*表1.8: 数据源版本存储策略对比*

### 版本保留策略

| 保留策略 | 说明 | 适用场景 |
|----------|------|----------|
| **固定数量** | 保留最近N个版本 | 一般场景，推荐N=10 |
| **时间窗口** | 保留最近T天内的所有版本 | 需要完整历史记录的场景 |
| **重要标记** | 标记重要版本永久保留 | 关键版本需要长期保存 |
| **组合策略** | 结合以上策略 | 复杂场景 |

*表1.9: 数据源版本保留策略*

---

## 1.5.3 分类表

分类表存储数据源的分类体系，支持多级树形结构。

### 树形结构实现方案对比

| 方案 | 优点 | 缺点 | 适用场景 |
|------|------|------|----------|
| **邻接表** | 简单直观<br>更新操作快 | 查询子树慢<br>需要递归查询 | 小型分类系统 |
| **路径枚举** | 查询子树快<br>无需递归 | 路径更新开销大<br>路径长度限制 | 中等规模系统 |
| **嵌套集** | 查询性能好<br>支持范围查询 | 更新复杂<br>并发问题 | 静态分类系统 |
| **ltree扩展** | 高效路径查询<br>原生支持 | PostgreSQL专属 | 大规模分类系统 |

*表1.10: 树形结构实现方案对比*

### 分类表索引性能

| 查询类型 | ltree (GiST) | 邻接表 | 嵌套集 | 提升比 |
|----------|--------------|--------|--------|--------|
| 查询子树 | 8ms | 120ms | 25ms | 15x |
| 查询祖先 | 5ms | 15ms | 10ms | 3x |
| 移动节点 | 25ms | 5ms | 50ms | - |
| 路径查询 | 3ms | 20ms | 15ms | 6.7x |
| 子节点计数 | 10ms | 100ms | 15ms | 10x |

*表1.11: 分类表索引性能对比*

---

## 📑 相关章节

| 前序 | 当前 | 后续 |
|-----|------|------|
| [1.4 核心组件详细实现](ch1-4.md) | **1.5 数据模型详细定义** | [1.6 API详细规范](ch1-6.md) |

**快速链接：**
- [1.4 核心组件详细实现](ch1-4.md)
- [1.6 API详细规范](ch1-6.md)
- [1.7 性能优化策略](ch1-7.md)
- [← 返回第1章首頁](ch1-index.md)
