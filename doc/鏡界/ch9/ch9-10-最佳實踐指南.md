**[← 返回第9章首頁](ch9-index.md)**

---

# 第9章：部署與運維管理系統 - 最佳實踐指南

## 部署策略

### 1. 金絲雀部署

```python
deployment_strategy = {
    "type": "canary",
    "initial_percentage": 5,    # 初始 5% 流量
    "increment": 20,             # 每次增加 20%
    "interval_minutes": 5,       # 5 分鐘檢查一次
    "rollback_threshold": 95     # 95% 失敗率時回滾
}
```

### 2. 藍綠部署

- 維護兩個生產環境
- 無縫切換流量
- 快速回滾

## 監控與告警

### 3. 關鍵指標

| 指標 | 警告值 | 嚴重值 |
|------|--------|--------|
| CPU 使用率 | 70% | 85% |
| 內存使用率 | 75% | 90% |
| 磁盤使用率 | 80% | 95% |
| 響應時間 | 500ms | 2000ms |

### 4. 告警規則

```yaml
rules:
  - name: HighCPUUsage
    condition: cpu_usage > 85
    duration: 5m
    severity: critical
    
  - name: ServiceDown
    condition: health_check_failed > 3
    duration: 1m
    severity: critical
```

## 故障恢復

### 5. RTO/RPO 目標

| 故障類型 | RTO | RPO |
|---------|-----|-----|
| 單節點故障 | 1分鐘 | 0秒 |
| 多節點故障 | 5分鐘 | 30秒 |
| 數據中心故障 | 30分鐘 | 5分鐘 |

### 6. 備份策略

```python
backup_config = {
    "frequency": "hourly",
    "retention": "30days",
    "replication": "multi-region",
    "verification": True
}
```

## 常見問題

### 問題 1: 部署失敗快速恢復

**自動回滾**
```python
if deployment_health_check() < 95%:
    trigger_rollback()
    notify_team()
```

### 問題 2: 資源不足

**自動擴容**
```python
if cpu_usage > 75% or memory_usage > 75%:
    scale_up_resources()
    update_load_balancer()
```

---

## 相關文件引用

- **核心實現**: [代碼示例 - 部署服務](../ch9-code-examples/ch9-code-01-deployment-service.md)
- **數據庫**: [代碼示例 - 數據庫定義](../ch9-code-examples/ch9-code-02-database-schema.md)
- **API**: [代碼示例 - API 端點](../ch9-code-examples/ch9-code-03-api-examples.md)
