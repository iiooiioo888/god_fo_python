# 第9章：系統整合與部署

## 9.3 監控與告警

**[← 返回第9章首頁](ch9-index.md)**

---

#### 9.3.1 監控指標

1. **系統级指標**
   ```yaml
   # system-metrics.yaml
   system:
     cpu:
       usage: "system_cpu_usage"
       limit: "system_cpu_limit"
     memory:
       usage: "system_memory_usage"
       limit: "system_memory_limit"
     disk:
       usage: "system_disk_usage"
       iops: "system_disk_iops"
     network:
       ingress: "system_network_ingress"
       egress: "system_network_egress"
   ```

2. **应用级指標**
   ```yaml
   # application-metrics.yaml
   application:
     http:
       requests_total: "http_requests_total"
       request_duration_seconds: "http_request_duration_seconds"
       errors_total: "http_errors_total"
     database:
       connections: "db_connections"
       query_duration_seconds: "db_query_duration_seconds"
       errors_total: "db_errors_total"
     queue:
       size: "queue_size"
       processing_time_seconds: "queue_processing_time_seconds"
     cache:
       hits: "cache_hits"
       misses: "cache_misses"
       evictions: "cache_evictions"
   ```

#### 9.3.2 告警规则

1. **系統健康告警**
   ```yaml
   # system-alerts.yaml
   alerts:
     - name: "High CPU Usage"
       expression: "system_cpu_usage > 0.9"
       for: "5m"
       severity: "critical"
       summary: "High CPU usage on {{ $labels.instance }}"
       description: "CPU usage is {{ $value }}% (threshold: 90%)"
     
     - name: "High Memory Usage"
       expression: "system_memory_usage > 0.85"
       for: "10m"
       severity: "warning"
       summary: "High memory usage on {{ $labels.instance }}"
       description: "Memory usage is {{ $value }}% (threshold: 85%)"
     
     - name: "Disk Space Low"
       expression: "system_disk_usage > 0.9"
       for: "15m"
       severity: "critical"
       summary: "Low disk space on {{ $labels.instance }}"
       description: "Disk usage is {{ $value }}% (threshold: 90%)"
   ```

2. **应用健康告警**
   ```yaml
   # application-alerts.yaml
   alerts:
     - name: "High HTTP Error Rate"
       expression: "rate(http_errors_total[5m]) / rate(http_requests_total[5m]) > 0.05"
       for: "5m"
       severity: "critical"
       summary: "High HTTP error rate for {{ $labels.service }}"
       description: "HTTP error rate is {{ $value }} (threshold: 5%)"
     
     - name: "Slow Database Queries"
       expression: "avg_over_time(db_query_duration_seconds[10m]) > 1.0"
       for: "10m"
       severity: "warning"
       summary: "Slow database queries for {{ $labels.service }}"
       description: "Average query duration is {{ $value }}s (threshold: 1.0s)"
     
     - name: "Queue Backlog"
       expression: "queue_size > 1000"
       for: "15m"
       severity: "warning"
       summary: "Queue backlog for {{ $labels.service }}"
       description: "Queue size is {{ $value }} (threshold: 1000)"
   ```

---

## 📑 相關章節

| 前序 | 當前 | 後續 |
|-----|------|------|
| [9.2 部署流程](ch9-2-部署流程.md) | **9.3 監控與告警** | [9.4 持續整合與持續部署](ch9-4-持續整合與持續部署.md) |

**快速鏈接：**
- [9.2 部署流程](ch9-2-部署流程.md)
- [9.4 持續整合與持續部署](ch9-4-持續整合與持續部署.md)
- [← 返回第9章首頁](ch9-index.md)
