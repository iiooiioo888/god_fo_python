# ç¬¬9ç« ï¼šç³»çµ±æ•´åˆèˆ‡éƒ¨ç½²

## 9.16 æ•ˆèƒ½æ¸¬è©¦æ–¹æ¡ˆ

**[â† è¿”å›ç¬¬9ç« é¦–é ](ch9-index.md)**

---

#### 9.16.1 åŸºæº–æ¸¬è©¦å ´æ™¯

1. **è³‡æ–™æºè¨»å†Šä¸­å¿ƒæ•ˆèƒ½æ¸¬è©¦**
   ```python
   # dsr_load_test.py
   import os
   import time
   import json
   import random
   from locust import HttpUser, task, between, events
   from locust.runners import MasterRunner
   
   # æ¸¬è©¦é…ç½®
   TEST_DATA_SOURCES = [
       {
           "name": f"test-source-{i}",
           "display_name": f"Test Source {i}",
           "url": f"https://example.com/data/{i}",
           "category": random.choice(["web", "api", "social"]),
           "data_type": random.choice(["html", "json", "xml"]),
           "tags": ["test", "performance"]
       } for i in range(1000)
   ]
   
   @events.test_start.add_listener
   def on_test_start(environment, **kwargs):
       """æ¸¬è©¦é–‹å§‹å‰çš„æº–å‚™å·¥ä½œ"""
       if not isinstance(environment.runner, MasterRunner):
           print(f"[{time.strftime('%Y-%m-%d %H:%M:%S')}] Starting DSR performance test")
           print(f"  * Test data sources: {len(TEST_DATA_SOURCES)}")
           print(f"  * Target RPS: {environment.parsed_options.spawn_rate}")
   
   class DataSourcesUser(HttpUser):
       wait_time = between(0.1, 0.5)
       
       def on_start(self):
           """ç”¨æˆ¶å•Ÿå‹•æ™‚çš„åˆå§‹åŒ–"""
           self.auth_token = self._get_auth_token()
           self.headers = {
               "Authorization": f"Bearer {self.auth_token}",
               "Content-Type": "application/json"
           }
       
       def _get_auth_token(self):
           """ç²å–èªè­‰ä»¤ç‰Œ"""
           response = self.client.post(
               "/api/v1/auth/token",
               json={
                   "client_id": "performance-test",
                   "client_secret": "perf-test-secret",
                   "grant_type": "client_credentials"
               }
           )
           return response.json()["access_token"]
       
       @task(5)
       def list_data_sources(self):
           """åˆ—å‡ºè³‡æ–™æº"""
           self.client.get(
               "/api/v1/data-sources",
               headers=self.headers,
               name="/api/v1/data-sources"
           )
       
       @task(3)
       def get_data_source(self):
           """ç²å–å–®å€‹è³‡æ–™æº"""
           source_id = f"ds-{random.randint(1, 1000):04d}"
           self.client.get(
               f"/api/v1/data-sources/{source_id}",
               headers=self.headers,
               name="/api/v1/data-sources/{id}"
           )
       
       @task(2)
       def create_data_source(self):
           """å‰µå»ºè³‡æ–™æº"""
           source = random.choice(TEST_DATA_SOURCES)
           self.client.post(
               "/api/v1/data-sources",
               json=source,
               headers=self.headers,
               name="/api/v1/data-sources"
           )
       
       @task(1)
       def search_data_sources(self):
           """æœå°‹è³‡æ–™æº"""
           query = random.choice(["test", "example", "api", "web"])
           self.client.get(
               f"/api/v1/data-sources?search={query}",
               headers=self.headers,
               name="/api/v1/data-sources:search"
           )
   ```

#### 9.16.2 æ•ˆèƒ½æŒ‡æ¨™é–¾å€¼

1. **APIæ•ˆèƒ½æŒ‡æ¨™é–¾å€¼**
   | æŒ‡æ¨™ | 95åˆ†ä½ | 99åˆ†ä½ | éŒ¯èª¤ç‡ | è³‡æºä½¿ç”¨ |
   |------|--------|--------|--------|----------|
   | **è³‡æ–™æºè¨»å†Šä¸­å¿ƒ** | | | | |
   | åˆ—å»ºè³‡æ–™æº | <200ms | <500ms | <0.1% | CPU<50%, Mem<70% |
   | ç²å–è³‡æ–™æºåˆ—è¡¨ | <100ms | <300ms | <0.1% | CPU<40%, Mem<60% |
   | æœå°‹è³‡æ–™æº | <150ms | <400ms | <0.1% | CPU<45%, Mem<65% |
   | **åˆ†å¸ƒå¼çˆ¬èŸ²é›†ç¾¤** | | | | |
   | å‰µå»ºçˆ¬èŸ²ä»»å‹™ | <100ms | <300ms | <0.1% | CPU<50%, Mem<70% |
   | ä»»å‹™ç‹€æ…‹æŸ¥è©¢ | <50ms | <200ms | <0.1% | CPU<30%, Mem<50% |
   | ç¯€é»å¿ƒè·³ | <20ms | <100ms | <0.01% | CPU<20%, Mem<40% |

2. **ç³»çµ±å®¹é‡è¦åŠƒ**
   | æœå‹™ | å–®ä¾‹é…ç½® | å–®ä¾‹æ•¸é‡ | æ”¯æ´QPS | æ¯æ—¥ä»»å‹™é‡ | å„²å­˜éœ€æ±‚ |
   |------|----------|----------|---------|------------|----------|
   | è³‡æ–™æºè¨»å†Šä¸­å¿ƒ | 2vCPU, 4GB | 3 | 1,000 | - | 50GB |
   | ç¶²ç«™æŒ‡ç´‹åˆ†æå¼•æ“ | 4vCPU, 8GB | 5 | 500 | - | 200GB |
   | è³‡æ–™æºå¥åº·ç›£æ¸¬ç³»çµ± | 2vCPU, 4GB | 3 | 2,000 | - | 100GB |
   | è³‡æ–™è™•ç†å·¥ä½œæµå¼•æ“ | 4vCPU, 8GB | 5 | 1,500 | - | 150GB |
   | è‡ªå‹•åŒ–åª’é«”è™•ç†ç®¡é“ | 8vCPU, 16GB, 1GPU | 10 | 100 | 10,000 | 10TB |
   | AIè¼”åŠ©é–‹ç™¼ç³»çµ± | 4vCPU, 8GB | 3 | 300 | - | 50GB |
   | è³‡æ–™åˆè¦èˆ‡å®‰å…¨ä¸­å¿ƒ | 2vCPU, 4GB | 3 | 500 | - | 75GB |
   | åˆ†å¸ƒå¼çˆ¬èŸ²é›†ç¾¤ç®¡ç†ç³»çµ± | 4vCPU, 8GB | 5 | 2,000 | 1,000,000 | 200GB |

---

## ğŸ“‘ ç›¸é—œç« ç¯€

| å‰åº | ç•¶å‰ | å¾ŒçºŒ |
|-----|------|------|
| [9.15 å®‰å…¨èˆ‡åˆè¦](ch9-15-å®‰å…¨èˆ‡åˆè¦.md) | **9.16 æ•ˆèƒ½æ¸¬è©¦æ–¹æ¡ˆ** | [9.17 ç½é›£æ¢å¾©è¨ˆç•«](ch9-17-ç½é›£æ¢å¾©è¨ˆç•«.md) |

**å¿«é€Ÿéˆæ¥ï¼š**
- [9.15 å®‰å…¨èˆ‡åˆè¦](ch9-15-å®‰å…¨èˆ‡åˆè¦.md)
- [9.17 ç½é›£æ¢å¾©è¨ˆç•«](ch9-17-ç½é›£æ¢å¾©è¨ˆç•«.md)
- [â† è¿”å›ç¬¬9ç« é¦–é ](ch9-index.md)

