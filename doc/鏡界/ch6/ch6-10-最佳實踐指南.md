**[← 返回第6章首頁](ch6-index.md)**

---

# 第6章：AI 輔助開發系統 - 最佳實踐指南

## 代碼生成最佳實踐

### 1. 提示詞設計

**推薦的提示詞結構**
```python
prompt = """
[背景說明]
你是一位資深的爬蟲工程師。

[任務描述]
生成用於爬取指定網站的代碼。

[具體要求]
1. 使用 requests 庫
2. 包含錯誤處理
3. 添加詳細註釋

[約束條件]
- 代碼必須可直接運行
- 遵循 PEP 8 規範
"""
```

### 2. 生成代碼驗證

```python
def validate_generated_code(code: str) -> bool:
    """驗證生成的代碼"""
    try:
        compile(code, '<generated>', 'exec')
        return True
    except SyntaxError:
        return False
```

## 錯誤診斷最佳實踐

### 3. 錯誤收集與分類

| 錯誤類型 | 常見原因 | 診斷方法 |
|---------|---------|---------|
| ConnectionError | 網絡問題 | 檢查反爬 |
| TimeoutError | 請求超時 | 調整超時 |
| ParsingError | HTML 變化 | 更新選擇器 |

### 4. 診斷工作流

```python
async def diagnose_workflow(error: str, code: str):
    # 1. 分類錯誤
    error_type = classify_error(error)
    
    # 2. 獲取相似案例
    similar_cases = kb.search(error_type)
    
    # 3. 調用 LLM 分析
    analysis = await llm.analyze_error(error, code, similar_cases)
    
    # 4. 返回修複建議
    return analysis
```

## 性能優化

### 5. 緩存策略

- **提示詞緩存**: 相同需求重用生成結果
- **知識庫索引**: 使用 Elasticsearch 加速搜索
- **會話記憶**: 保存對話上下文減少重複

### 6. 批量処理

```python
batch_requests = [
    {"requirement": "爬取商品列表", "language": "python"},
    {"requirement": "爬取評論", "language": "javascript"}
]

results = await asyncio.gather(*[
    generate_code(req) for req in batch_requests
])
```

## 常見問題

### 問題 1: 生成的代碼質量不穩定

**原因**
- 提示詞不夠清晰
- LLM 溫度設置過高

**解決**
```python
# 降低溫度提高一致性
response = llm.generate(
    prompt=optimized_prompt,
    temperature=0.3,  # 從 0.7 降低到 0.3
    max_tokens=2048
)
```

### 問題 2: 分析錯誤耗時過長

**優化**
1. 使用快速路徑 (基於規則的診斷)
2. 對常見錯誤使用預定義答案
3. 異非同步批量處理

---

## 相關文件引用

- **核心實現**: [代碼示例 - LLM 集成](../ch6-code-examples/ch6-code-01-llm-integration.md)
- **數據庫**: [代碼示例 - 數據庫定義](../ch6-code-examples/ch6-code-02-database-schema.md)
- **API**: [代碼示例 - API 端點](../ch6-code-examples/ch6-code-03-api-examples.md)
