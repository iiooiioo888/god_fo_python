# 第1章：資料源註冊中心 (Data Source Registry)

## 1.5 資料模型詳細定義

**[← 返回第1章首頁](ch1-index.md)**

---

## 1.5.1 資料源核心表

資料源核心表是儲存資料源元資料的主要表，設計考慮了擴展性、查詢效能和資料完整性。

### 核心字段分類

| 字段类别 | 字段示例 | 說明 |
|----------|----------|------|
| **標识字段** | id, project_id, name | 資料源的唯一標识和归属 |
| **元資料字段** | description, url, category, data_type | 資料源的基本資訊和定義 |
| **狀態字段** | status, created_at, updated_at, owner_id | 資料源的狀態和生命週期資訊 |
| **健康指標** | last_health_check, health_score, availability_7d | 資料源的健康状况指標 |
| **擴展字段** | tags, metadata, crawler_config | 可擴展的自定義資訊 |

*表1.6: 資料源核心表字段分類*

### 索引策略

| 索引名称 | 字段组合 | 用途 | 适用場景 |
|----------|----------|------|----------|
| **idx_data_sources_project** | project_id | 按專案查詢 | 專案内資料源查詢 |
| **idx_data_sources_category** | category | 按分類查詢 | 分類浏览場景 |
| **idx_data_sources_status** | status | 按狀態過滤 | 狀態筛选查詢 |
| **idx_data_sources_health** | health_score DESC | 按健康評分排序 | 健康狀態排序 |
| **idx_data_sources_updated** | updated_at DESC | 按更新時間排序 | 最新更新排序 |

*表1.7: 資料源核心表索引策略*

### 全文搜尋優化

- 使用PostgreSQL的tsvector類型儲存全文搜尋向量
- 通過触发器自動更新搜尋向量
- 创建GIN索引提高搜尋效能

---

## 1.5.2 資料源版本表

資料源版本表記錄資料源的所有變更歷史，支援版本管理和回滚操作。

### 版本管理策略

| 策略 | 說明 | 优势 | 适用場景 |
|------|------|------|----------|
| **完整儲存** | 儲存每次變更的完整資料 | 简单直观，恢復快 | 變更不频繁的資料源 |
| **差异儲存** | 仅儲存與前一版本的差异 | 節省儲存空间 | 频繁變更的資料源 |
| **快照儲存** | 定期创建完整快照 | 平衡儲存和恢復效能 | 大型資料源 |
| **混合儲存** | 結合以上策略 | 灵活平衡各方面需求 | 複杂場景 |

*表1.8: 資料源版本儲存策略對比*

### 版本保留策略

| 保留策略 | 說明 | 适用場景 |
|----------|------|----------|
| **固定數量** | 保留最近N個版本 | 一般場景，推薦N=10 |
| **時間窗口** | 保留最近T天内的所有版本 | 需要完整歷史記錄的場景 |
| **重要標记** | 標记重要版本永久保留 | 關鍵版本需要長期保存 |
| **组合策略** | 結合以上策略 | 複杂場景 |

*表1.9: 資料源版本保留策略*

---

## 1.5.3 分類表

分類表儲存資料源的分類體系，支援多级树形結構。

### 树形結構實現方案對比

| 方案 | 优点 | 缺点 | 适用場景 |
|------|------|------|----------|
| **邻接表** | 简单直观<br>更新操作快 | 查詢子树慢<br>需要递归查詢 | 小型分類系統 |
| **路径枚举** | 查詢子树快<br>无需递归 | 路径更新開销大<br>路径長度限制 | 中等规模系統 |
| **嵌套集** | 查詢效能好<br>支援范围查詢 | 更新複杂<br>並發问题 | 静态分類系統 |
| **ltree擴展** | 高效路径查詢<br>原生支援 | PostgreSQL专属 | 大規模分類系統 |

*表1.10: 树形結構實現方案對比*

### 分類表索引效能

| 查詢類型 | ltree (GiST) | 邻接表 | 嵌套集 | 提升比 |
|----------|--------------|--------|--------|--------|
| 查詢子树 | 8ms | 120ms | 25ms | 15x |
| 查詢祖先 | 5ms | 15ms | 10ms | 3x |
| 移動節点 | 25ms | 5ms | 50ms | - |
| 路径查詢 | 3ms | 20ms | 15ms | 6.7x |
| 子節点计數 | 10ms | 100ms | 15ms | 10x |

*表1.11: 分類表索引效能對比*

---

## 📑 相關章節

| 前序 | 當前 | 後續 |
|-----|------|------|
| [1.4 核心組件詳細實現](ch1-4-核心組件詳細實現.md) | **1.5 資料模型詳細定義** | [1.6 API詳細規範](ch1-6-API詳細規範.md) |

**快速鏈接：**
- [1.4 核心組件詳細實現](ch1-4-核心組件詳細實現.md)
- [1.6 API詳細規範](ch1-6-API詳細規範.md)
- [1.7 效能優化策略](ch1-7-效能優化策略.md)
- [← 返回第1章首頁](ch1-index.md)
